<html>
  <head>
    <meta charset="utf-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>å¾®ä¿¡å…¬å·DIYï¼šè®­ç»ƒèŠå¤©æœºå™¨äºº&amp;å…¬å·å˜èº«å›¾ç‰‡ä¸Šä¼ å·¥å…· | é¡¾æ–¯æ¯”</title>
<link rel="shortcut icon" href="http://blog.gusibi.site/favicon.ico?v=1593958900039">
<link href="https://cdn.jsdelivr.net/npm/remixicon@2.3.0/fonts/remixicon.css" rel="stylesheet">
<link rel="stylesheet" href="http://blog.gusibi.site/styles/main.css">
<link rel="alternate" type="application/atom+xml" title="å¾®ä¿¡å…¬å·DIYï¼šè®­ç»ƒèŠå¤©æœºå™¨äºº&amp;å…¬å·å˜èº«å›¾ç‰‡ä¸Šä¼ å·¥å…· | é¡¾æ–¯æ¯” - Atom Feed" href="http://blog.gusibi.site/atom.xml">
<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Droid+Serif:400,700">


<script async src="https://www.googletagmanager.com/gtag/js?id=UA-76238744-1"></script>
<script>
  window.dataLayer = window.dataLayer || [];
  function gtag(){dataLayer.push(arguments);}
  gtag('js', new Date());

  gtag('config', 'UA-76238744-1');
</script>


    <meta name="description" content="ä¸Šä¸€ç¯‡ ä¸€å°æ—¶æ­å»ºå¾®ä¿¡èŠå¤©æœºå™¨äºº ä»‹ç»äº†å¦‚ä½•æ­å»ºä¸€ä¸ªå¯ç”¨çš„èŠå¤©æœºå™¨äººï¼Œä½†æ˜¯å’Œæœºå™¨äººèŠå®Œä½ ä¼šå‘ç°ï¼ŒèŠå¤©æœºå™¨äººå®åœ¨æ˜¯å¤ªå‚»äº†ï¼Œæ¥å›å°±é‚£ä¹ˆå‡ å¥ã€‚è¿™æ˜¯å› ä¸ºæˆ‘ä»¬ç»™èŠå¤©æœºå™¨äººçš„æ•°æ®å¤ªå°‘ï¼Œä»–åªèƒ½åœ¨æˆ‘ä»¬ç»™çš„è®­ç»ƒé›†ä¸­æ‰¾å®ƒè®¤ä¸ºæœ€åˆé€‚çš„ã€‚é‚£ä¹ˆï¼Œå¦‚ä½•å¯¼å…¥æ›´å¤šçš„è®­ç»ƒæ•°..." />
    <meta name="keywords" content="tutorial,python,å…¬ä¼—å·,weixin" />
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/KaTeX/0.10.0/katex.min.css">
    <script src="https://cdn.bootcss.com/highlight.js/9.12.0/highlight.min.js"></script>
  </head>
  <body>
    <div class="main">
      <div class="main-content">
        <div class="site-header">
  <a href="http://blog.gusibi.site">
  <img class="avatar" src="http://blog.gusibi.site/images/avatar.png?v=1593958900039" alt="">
  </a>
  <h1 class="site-title">
    é¡¾æ–¯æ¯”
  </h1>
  <p class="site-description">
    è¿™ä¸ªäººå¾ˆæ‡’
  </p>
  <div class="menu-container">
    
      
        <a href="/" class="menu">
          é¦–é¡µ
        </a>
      
    
      
        <a href="/archives" class="menu">
          å½’æ¡£
        </a>
      
    
      
        <a href="/tags" class="menu">
          æ ‡ç­¾
        </a>
      
    
      
        <a href="/post/about" class="menu">
          å…³äº
        </a>
      
    
  </div>
  <div class="social-container">
    
      
        <a href="https://github.com/gusibi" target="_blank">
          <i class="ri-github-line"></i>
        </a>
      
    
      
        <a href="https://twitter.com/amazing_gs" target="_blank">
          <i class="ri-twitter-line"></i>
        </a>
      
    
      
    
      
    
      
    
  </div>
</div>

        <div class="post-detail">
          <article class="post">
            <h2 class="post-title">
              å¾®ä¿¡å…¬å·DIYï¼šè®­ç»ƒèŠå¤©æœºå™¨äºº&amp;å…¬å·å˜èº«å›¾ç‰‡ä¸Šä¼ å·¥å…·
            </h2>
            <div class="post-info">
              <span>
                2017-07-08
              </span>
              <span>
                11 min read
              </span>
              
                <a href="http://blog.gusibi.site/tag/JjoHj10VdB/" class="post-tag">
                  # tutorial
                </a>
              
                <a href="http://blog.gusibi.site/tag/CsxMxAMxzZ/" class="post-tag">
                  # python
                </a>
              
                <a href="http://blog.gusibi.site/tag/Vo0Pk96Rxe/" class="post-tag">
                  # å…¬ä¼—å·
                </a>
              
                <a href="http://blog.gusibi.site/tag/hHHzJqiTzdW/" class="post-tag">
                  # weixin
                </a>
              
            </div>
            
            <div class="post-content-wrapper">
              <div class="post-content">
                <p>ä¸Šä¸€ç¯‡ <a href="http://blog.gusibi.site/post/wechat-chatbot-step-by-step/">ä¸€å°æ—¶æ­å»ºå¾®ä¿¡èŠå¤©æœºå™¨äºº</a> ä»‹ç»äº†å¦‚ä½•æ­å»ºä¸€ä¸ªå¯ç”¨çš„èŠå¤©æœºå™¨äººï¼Œä½†æ˜¯å’Œæœºå™¨äººèŠå®Œä½ ä¼šå‘ç°ï¼ŒèŠå¤©æœºå™¨äººå®åœ¨æ˜¯å¤ªå‚»äº†ï¼Œæ¥å›å°±é‚£ä¹ˆå‡ å¥ã€‚è¿™æ˜¯å› ä¸ºæˆ‘ä»¬ç»™èŠå¤©æœºå™¨äººçš„æ•°æ®å¤ªå°‘ï¼Œä»–åªèƒ½åœ¨æˆ‘ä»¬ç»™çš„è®­ç»ƒé›†ä¸­æ‰¾å®ƒè®¤ä¸ºæœ€åˆé€‚çš„ã€‚é‚£ä¹ˆï¼Œå¦‚ä½•å¯¼å…¥æ›´å¤šçš„è®­ç»ƒæ•°æ®å‘¢ï¼Ÿ<br>
æˆ‘èƒ½æƒ³åˆ°æœ€ç®€å•çš„æ–¹æ³•æ˜¯æ‰¾å¯¹è¯çš„æ•°æ®ï¼Œç„¶åæŠŠè¿™äº›æ•°æ®ä½œä¸ºè®­ç»ƒæ•°æ®è®­ç»ƒæœºå™¨äººã€‚</p>
<p>æ„Ÿè°¢ candlewill å·²ç»æ”¶é›†å¥½äº†å¤§é‡çš„è®­ç»ƒæ•°æ®ï¼Œ<a href="https://github.com/candlewill/Dialog_Corpus">dialog_corpus https://github.com/candlewill/Dialog_Corpus</a> ã€‚</p>
<p>HUGOMORE42</p>
<p>è¿™ä¸ªåº“ä¸­åŒ…å«ç”µå½±å°è¯ã€ä¸­è‹±æ–‡çŸ­ä¿¡æ¯ã€è‡ªç„¶è¯­è¨€å¤„ç†ç›¸å…³çš„æ•°æ®é›†ã€å°é»„é¸¡è¯­æ–™ç­‰ã€‚è¿™é‡Œæˆ‘é€‰æ‹©ç”µå½±å°è¯è¯­æ–™ã€‚</p>
<blockquote>
<p>è¯­æ–™åœ°å€ä¸ºï¼š<a href="https://github.com/rustch3n/dgk_lost_conv">dgk_lost_convï¼šhttps://github.com/rustch3n/dgk_lost_conv</a></p>
</blockquote>
<h2 id="chatterbot-è®­ç»ƒé€»è¾‘å¤„ç†æ¨¡å—">chatterbot è®­ç»ƒé€»è¾‘å¤„ç†æ¨¡å—</h2>
<p>è¿™ä¸ªæ¨¡å—æä¾›è®­ç»ƒæœºå™¨äººçš„æ–¹æ³•ï¼Œchatterbotè‡ªå¸¦äº†é€šè¿‡è¾“å…¥listæ¥è®­ç»ƒï¼ˆ[&quot;ä½ å¥½&quot;, &quot;ä½ å¥½å•Š&quot;] åè€…æ˜¯å‰è€…çš„å›ç­”ï¼‰ä»¥åŠé€šè¿‡å¯¼å…¥Corpusæ ¼å¼æ–‡ä»¶æ¥è®­ç»ƒçš„æ–¹å¼ã€‚</p>
<p>è¿™é‡Œæˆ‘ä»¬é€‰æ‹©ä½¿ç”¨ç¬¬ä¸€ç§ï¼Œé€šè¿‡è¾“å…¥listæ¥è®­ç»ƒæœºå™¨äººã€‚</p>
<h3 id="å¤„ç†è®­ç»ƒæ•°æ®">å¤„ç†è®­ç»ƒæ•°æ®</h3>
<p>é¦–å…ˆä¸‹è½½æ•°æ®é›†ï¼š</p>
<pre><code class="language-sh">wget https://codeload.github.com/rustch3n/dgk_lost_conv/zip/master
# è§£å‹
$ unzip dgk_lost_conv-master.zip
</code></pre>
<p>æˆ‘ä»¬å…ˆæ‰“å¼€ä¸€ä¸ªæ–‡ä»¶çœ‹ä¸‹æ•°æ®ç»“æ„ï¼š</p>
<pre><code class="language-sh">E
M ä½ å¾—æƒ³æƒ³åŠæ³• æˆ‘å¼Ÿå¼Ÿæ˜¯æ— è¾œçš„
M ä»–å¯æ˜¯ç¾å›½å…¬æ°‘å•Š
M å¯¹æ­¤æˆ‘ä¹Ÿæ— èƒ½ä¸ºåŠ›
M ä½ å½“ç„¶èƒ½
M å†å»çŠ¯ç½ªç°åœºçœ‹çœ‹ å®šèƒ½è¯å®æ¸…ç™½
M ä½ çœ‹ æˆ‘ä¸è¿‡æ˜¯ä¸ªå¤œé—´åŠäº‹å‘˜è€Œå·²
M ä½ è‹¥çœŸæƒ³è§£å†³é—®é¢˜
M æœ€å¥½ç­‰é¢†äº‹æ¥
M ä»–æ—©ä¸Šæ‰ä¸Šç­
M æˆ‘å¾ˆæŠ±æ­‰
E
M é‚£æˆ‘è‡ªå·±æ¥æå®š
M ä½ å…„å¼Ÿ
M å…³åœ¨å“ªä¸ªç›‘ç‹±?
M ç´¢çº³ç›‘ç‹±
E
M æ€ä¹ˆäº†?
M é‚£é‡Œå…³çš„éƒ½æ˜¯æœ€ç©·å‡¶ææ¶çš„ç½ªçŠ¯
M åˆ«çš„ç›‘ç‹±éƒ½ä¸æ”¶
</code></pre>
<p>.conv è¯­æ–™æ–‡ä»¶ä¸­ï¼šE æ˜¯åˆ†éš”ç¬¦ M è¡¨ç¤ºä¼šè¯ã€‚å› ä¸ºæˆ‘æ˜¯ä½¿ç”¨è¾“å…¥list çš„æ–¹å¼è®­ç»ƒæ•°æ®ï¼Œè¿™æ—¶æˆ‘å¯ä»¥ä»¥åˆ†éš”ç¬¦Eä¸ºåˆ†éš”ï¼Œå°†ä¸€æ®µå¯¹è¯æ”¾å…¥ä¸€ä¸ªlistä¸­ï¼Œé‚£ä¹ˆä¸Šè¿°ä¾‹å­ä¸­çš„è®­ç»ƒæ•°æ®åº”è¯¥è¢«æ ¼å¼åŒ–ä¸ºï¼š</p>
<pre><code class="language-python">convs = [
    [
       'ä½ å¾—æƒ³æƒ³åŠæ³• æˆ‘å¼Ÿå¼Ÿæ˜¯æ— è¾œçš„',
       'ä»–å¯æ˜¯ç¾å›½å…¬æ°‘å•Š',
       'å¯¹æ­¤æˆ‘ä¹Ÿæ— èƒ½ä¸ºåŠ›',
       'ä½ å½“ç„¶èƒ½',
       'å†å»çŠ¯ç½ªç°åœºçœ‹çœ‹ å®šèƒ½è¯å®æ¸…ç™½',
       'ä½ çœ‹ æˆ‘ä¸è¿‡æ˜¯ä¸ªå¤œé—´åŠäº‹å‘˜è€Œå·²',
       'ä½ è‹¥çœŸæƒ³è§£å†³é—®é¢˜',
       'æœ€å¥½ç­‰é¢†äº‹æ¥',
       'ä»–æ—©ä¸Šæ‰ä¸Šç­',
       'æˆ‘å¾ˆæŠ±æ­‰'
    ],
    [
       'é‚£æˆ‘è‡ªå·±æ¥æå®š',
       'ä½ å…„å¼Ÿ',
       'å…³åœ¨å“ªä¸ªç›‘ç‹±?',
       'ç´¢çº³ç›‘ç‹±',
    ],
    [
       'æ€ä¹ˆäº†?',
       'é‚£é‡Œå…³çš„éƒ½æ˜¯æœ€ç©·å‡¶ææ¶çš„ç½ªçŠ¯',
       'åˆ«çš„ç›‘ç‹±éƒ½ä¸æ”¶',
    ]
]
</code></pre>
<p>å¯¼å…¥è®­ç»ƒæ•°æ®çš„è„šæœ¬å¦‚ä¸‹ï¼š</p>
<pre><code class="language-python">from chatterbot import ChatBot
from chatterbot.trainers import ListTrainer

# åˆå§‹åŒ–èŠå¤©æœºå™¨äºº
momo = ChatBot(
    'Momo',
    storage_adapter='chatterbot.storage.MongoDatabaseAdapter', # ä½¿ç”¨mongoå­˜å‚¨æ•°æ®
    logic_adapters=[ # æŒ‡å®šé€»è¾‘å¤„ç†æ¨¡å—
            &quot;chatterbot.logic.BestMatch&quot;,
            &quot;chatterbot.logic.MathematicalEvaluation&quot;,
            &quot;chatterbot.logic.TimeLogicAdapter&quot;,
        ],
    input_adapter='chatterbot.input.VariableInputTypeAdapter',
    output_adapter='chatterbot.output.OutputAdapter',
    database='chatterbot', # æŒ‡å®šæ•°æ®åº“
    read_only=True
)

# è¯»å–.conv æ•°æ®æ–‡ä»¶ï¼Œå› ä¸ºæˆ‘æœåŠ¡å™¨é…ç½®è¾ƒä½ï¼Œæ‰€ä»¥é€‰æ‹©äº†ä¸€ä¸ªå†…å®¹è¾ƒå°‘çš„æ–‡ä»¶
# è¿™ä¸ªå‡½æ•°æ˜¯ä¸€ä¸ªç”Ÿæˆå™¨
def read_conv(filename='prisonb.conv'):
    with open(filename, 'rt') as f:
        conv = []
        # é€è¡Œè¯»å–
        for line in f:
            _line = line.replace('\n', '').strip()  # é¢„å¤„ç†å­—ç¬¦ä¸² å»æ‰é¦–ä½ç©ºæ ¼
            if _line == 'E':  # å¦‚æœæ˜¯åˆ†éš”ç¬¦ è¡¨ç¤ºå¯¹è¯ç»“æŸ è¿”å›å¯¹è¯åˆ—è¡¨
                yield conv
                conv = []  # é‡ç½®å¯¹è¯åˆ—è¡¨
            else:  # ä¸æ˜¯åˆ†éš”ç¬¦åˆ™å°†å†…å®¹åŠ å…¥å¯¹è¯åˆ—è¡¨
                c = _line.split()[-1]  # å…¶å®è¿™é‡Œå¦‚æœå¯¹è¯ä¸­åŒ…å«ç©ºæ ¼ å¯¹è¯æ•°æ®ä¼šä¸å®Œæ•´ï¼Œåº”è¯¥åªå»æ‰Må’Œå¼€å¤´çš„ç©ºæ ¼
                conv.append(c)


def traine_momo():
    for conv in read_conv():
        print(conv)
        momo.set_trainer(ListTrainer) # æŒ‡å®šè®­ç»ƒæ–¹å¼
        momo.train(conv) # è®­ç»ƒæ•°æ®


def main():
    traine_momo()


if __name__ == '__main__':
    main()

</code></pre>
<p>è¿™ä¸ªè„šæœ¬æ¯”è¾ƒç®€å•ï¼Œåªæ˜¯ç®€å•çš„å°†æ•°æ®ä»å¯¹è¯æ–‡ä»¶ä¸­è¯»å–å‡ºæ¥ï¼Œç„¶åæ‹¼æ¥ä¸ºå¯¹è¯åˆ—è¡¨è¾“å…¥èŠå¤©æœºå™¨äººã€‚</p>
<blockquote>
<p>ç”±äºè¿™é‡Œå¯¹è¯å¤§éƒ¨åˆ†éƒ½æ˜¯å¤šè¡Œæ•°æ®ï¼ŒèŠå¤©æœºå™¨äººåŒ¹é…ç»“æœæ—¶è¿ç®—é‡ä¼šå¤§å¹…æå‡ï¼Œæˆ‘å•æ ¸cpuçš„æœåŠ¡å™¨åœ¨å¯¼å…¥ä¸€ä¸ª700k çš„è¯­æ–™æ–‡ä»¶åæ¯æ¬¡èŠå¤©éƒ½ä¼šè®©cpué£šåˆ°100%ï¼ğŸ¤¦â€ æ— å¥ˆä¹‹ä¸‹åªèƒ½åˆ æ‰å¤§åŠæ•°æ®ã€‚</p>
</blockquote>
<p>å¯¹è¯ç¤ºä¾‹å¦‚å›¾:</p>
<figure data-type="image" tabindex="1"><img src="http://media.gusibi.mobi/kF27RcGVBL3xDf4kKhJQCbXAB3qgc_HXpYy28ykdfudK0B52Z5nvm63m0wbiKlCA" alt="ä½¿ç”¨ç”µå½±å°è¯è®­ç»ƒåçš„èŠå¤©æˆªå›¾" loading="lazy"></figure>
<p>å¯¼å…¥ç”µå½±å°è¯åï¼Œè™½ç„¶è®­ç»ƒæ•°æ®å¤§å¹…æå‡ï¼Œä½†æ˜¯ä½ ä¼šå‘ç°èŠå¤©æœºå™¨äººå¼€å§‹ç­”éæ‰€é—®äº†ï¼Œè¿™æ˜¯å› ä¸ºèŠå¤©æ•°æ®å™ªéŸ³å¤ªå¤§ï¼Œå¯¹ç™½ä¹Ÿæœ‰ç‚¹é—®é¢˜ã€‚</p>
<h3 id="ä½¿ç”¨å›¾çµæœºå™¨äººè®­ç»ƒ">ä½¿ç”¨å›¾çµæœºå™¨äººè®­ç»ƒ</h3>
<p>ä¹‹å‰åœ¨å¯¹æ¯”èŠå¤©æœºå™¨äººå®ç°æ–¹æ¡ˆçš„æ—¶å€™ï¼Œæˆ‘è¯•ç”¨è¿‡ <a href="http://www.tuling123.com">å›¾çµæœºå™¨äºº</a>ï¼Œä»–ä»¬å·ç§°ä¸­æ–‡è¯­å¢ƒä¸‹æ™ºèƒ½æ¸¡æœ€é«˜çš„æœºå™¨äººå¤§è„‘ã€‚ä»–ä»¬çš„å¯¹è¯æ¯”æˆ‘è‡ªå·±çš„æ­å»ºçš„é è°±å¾ˆå¤šï¼Œé‚£ä¹ˆæˆ‘ä»¬æ˜¯ä¸æ˜¯å¯ä»¥åˆ©ç”¨ä¸€ä¸‹ä»–çš„æ•°æ®å‘¢ï¼Ÿ</p>
<p>æˆ‘çš„æ–¹æ¡ˆæ˜¯è¿™æ ·çš„ï¼Œåœ¨å›¾çµæœºå™¨äººæ–°å»ºä¸¤ä¸ªæœºå™¨äººæ•™ç»ƒA å’Œ æ•™ç»ƒBï¼Œè®©ä¸¤ä¸ªæœºå™¨äººäº’ç›¸å¯¹è¯ï¼Œç„¶åæŠŠè®­ç»ƒæ•°æ®å¯¼å…¥chatterbotã€‚</p>
<ol>
<li>æ‰“å¼€ <a href="http://www.tuling123.com">http://www.tuling123.com</a>ï¼Œæ³¨å†Œè´¦å·</li>
<li>æ–°å»ºä¸¤ä¸ªæœºå™¨äººï¼ˆå…è´¹ç”¨æˆ·æœ€å¤šå¯ä»¥åˆ›å»º5ä¸ªï¼Œæ¯ä¸ªæœºå™¨äººæ¯å¤©æœ€å¤šè¯·æ±‚5000æ¬¡ï¼‰</li>
<li>è°ƒç”¨å¯¹è¯APIï¼Œè®©ä¸¤ä¸ªæœºå™¨äººäº’ç›¸èŠå¤©</li>
</ol>
<p>å»ºå¥½æœºå™¨äººåçš„ç•Œé¢ï¼š</p>
<figure data-type="image" tabindex="2"><img src="http://media.gusibi.mobi/3WZasRFKofxaVIV55WJy2TNRYeUlf7qcD5ijEpYZqwJctWzuAqu3HRBi8VRZSFYz" alt="æœºå™¨äººç¤ºä¾‹ğŸ¤–" loading="lazy"></figure>
<p>è®­ç»ƒç¤ºä¾‹ä»£ç å¦‚ä¸‹ï¼š</p>
<pre><code class="language-python"># tuling_trainer.py
import sys
from time import sleep

from chatterbot import ChatBot
from chatterbot.trainers import ListTrainer

import requests

API_URL = &quot;http://www.tuling123.com/openapi/api&quot;
API_KEY0 = &quot;&quot;  # æœºå™¨äºº1 çš„key
API_KEY1 = &quot;&quot;  # æœºå™¨äºº2 çš„key

# åˆå§‹åŒ–chatterbot
momo = ChatBot(
    'Momo',
    storage_adapter='chatterbot.storage.MongoDatabaseAdapter',
    logic_adapters=[
            &quot;chatterbot.logic.BestMatch&quot;,
            &quot;chatterbot.logic.MathematicalEvaluation&quot;,
            &quot;chatterbot.logic.TimeLogicAdapter&quot;,
        ],
    input_adapter='chatterbot.input.VariableInputTypeAdapter',
    output_adapter='chatterbot.output.OutputAdapter',
    database='chatterbot',
    read_only=True
)

# è¯·æ±‚å›¾çµæœºå™¨äººæ¥å£
def ask(question, key, name):
    params = {
        &quot;key&quot;: key,
        &quot;userid&quot;: name,
        &quot;info&quot;: question,
    }
    res = requests.post(API_URL, json=params)
    result = res.json()
    answer = result.get('text')
    return answer


def A(bsay):
    # æ‰“å° A å’Œ B çš„å¯¹è¯å†…å®¹
    print('B:', bsay)
    answer = ask(bsay, API_KEY0, 'momo123')
    print('A:', answer)
    return answer


def B(asay):
    print('A:', asay)
    answer = ask(asay, API_KEY1, 'momo456')
    print('B', answer)
    return answer


def tariner(asay):
    momo.set_trainer(ListTrainer)  # è®¾ç½®å¤„ç†æ–¹å¼
    while True:  # ä¸¤ä¸ªæœºå™¨äººè®­ç»ƒçš„ä¸»å¾ªç¯
        conv = []
        conv.append(asay) # å…ˆæŠŠ A è¯´çš„ç¬¬ä¸€å¥åŠ å…¥åˆ°å¯¹è¯åˆ—è¡¨
        bsay = B(asay)  # A å…ˆé—® B
        conv.append(bsay) # å°†B çš„å›ç­”åŠ å…¥åˆ°å¯¹è¯åˆ—è¡¨
        momo.train(conv) # å°†å¯¹è¯ç”¨äºè®­ç»ƒ
        print(conv)
        conv = []
        conv.append(bsay) # ç”¨Bçš„å¯¹è¯ å»é—® A æ­¥éª¤å’Œä¸Šè¿°æ–¹å¼ä¸€è‡´
        asay = A(bsay)
        conv.append(asay)
        momo.train(conv)
        print(conv)
        sleep(5)  # æ§åˆ¶é¢‘ç‡


def main(asay):
    tariner(asay)


if __name__ == '__main__':
    main(*sys.argv[1:])  # æ¥æ”¶å‚æ•°ä½œä¸ºå¼€å§‹çš„ç¬¬ä¸€å¥è¯
    
# æ‰§è¡Œè„šæœ¬
# python tuling_trainer.py ä½ å¥½ï¼Ÿ

</code></pre>
<p>ä½¿ç”¨å›¾çµèŠå¤©æœºå™¨äººè®­ç»ƒçš„æ—¶å€™æ˜¯éœ€è¦ç›‘æµ‹çš„ï¼Œå› ä¸ºå¦‚æœä¸¤ä¸ªæœºå™¨äººè¯´çš„å†…å®¹ä¸€æ ·çš„æ—¶å€™ï¼Œæœºå™¨äººå¯èƒ½ä¼šä¸€ç›´é‡å¤åŒä¸€å¥è¯ï¼Œç›´åˆ°è°ƒç”¨æ¬¡æ•°è€—å°½ï¼Œä½ éœ€è¦çœ‹ä¸€ä¸‹ä¸¤ä¸ªæœºå™¨äººçš„å¯¹è¯æ˜¯å¦é™·å…¥äº†åƒµå±€ã€‚</p>
<p>å½“ç„¶ä¹Ÿå¯ä»¥åœ¨ç¨‹åºä¸­åŠ å…¥åˆ¤æ–­ï¼Œå…ˆå¤šè®¾å®šå‡ ä¸ªå¼€å§‹æ‰“æ‹›å‘¼çš„å¥å­ï¼Œå¦‚æœä¸€å¥è¯è¿ç»­å‡ºç°å¤šæ¬¡çš„æ—¶å€™ï¼Œæ¢ä¸‹ä¸€ä¸ªå¥å­çº æ­£ä»–ä»¬ã€‚</p>
<p>ä»¥ä¸‹æ˜¯æˆ‘è®­ç»ƒäº†ä¸¤å¤©ä¹‹åçš„ç»“æœï¼š</p>
<figure data-type="image" tabindex="3"><img src="http://media.gusibi.mobi/wNM0i84JsmsgldhxUjV1TMHr_YwwM726brHr0tmSYS_cxAYWWIHQEvG-eTmBIRjJ" alt="å¯¹è¯ç¤ºä¾‹" loading="lazy"></figure>
<p>è™½ç„¶è¿˜æ˜¯ç­”éæ‰€é—®ï¼Œä½†æ˜¯å·²ç»æ¯”ä¹‹å‰åƒæ ·äº†ã€‚</p>
<blockquote>
<p>å›¾çµèŠå¤©æœºå™¨äººå…è´¹ç‰ˆæ¯å¤©å¯è°ƒç”¨5000 æ¬¡ï¼Œå¦‚æœè§‰å¾—æ¬¡æ•°å¤ªå°‘å¯ä»¥å¤šæ–°å»ºå‡ ä¸ªè½®æµä½¿ç”¨</p>
</blockquote>
<p>èŠå¤©æœºå™¨äººçš„é…ç½®åŠè®­ç»ƒæ–¹å¼å°±åˆ°è¿™é‡Œäº†ï¼Œæ¥ä¸‹æ¥ä»‹ç»ä¸ªæ›´å®ç”¨çš„åŠŸèƒ½ï¼Œå¦‚ä½•è®©å¾®ä¿¡å…¬å·å˜æˆå›¾åºŠã€‚</p>
<h2 id="å¦‚ä½•è®©å¾®ä¿¡å…¬å·åŒ–èº«å›¾ç‰‡ä¸Šä¼ åŠ©æ‰‹">å¦‚ä½•è®©å¾®ä¿¡å…¬å·åŒ–èº«å›¾ç‰‡ä¸Šä¼ åŠ©æ‰‹</h2>
<p>åœ¨ä½¿ç”¨ <code>markdown</code> æ ¼å¼æ¥å†™æ–‡ç« çš„è¿‡ç¨‹ä¸­ï¼Œå‘ç°å›¾ç‰‡åœ°å€æ˜¯ä¸€ä¸ªæ¯”è¾ƒéº»çƒ¦çš„äº‹æƒ…ï¼Œæ¯æ¬¡è´´å›¾è·å–å›¾ç‰‡URLéƒ½æ˜¯ä¸€ä¸ªæ¯”è¾ƒéº»çƒ¦çš„è¿‡ç¨‹ã€‚<br>
ä»¥æˆ‘ä½¿ç”¨çš„ä¸ƒç‰›ä¸ºä¾‹ï¼Œè·å–å›¾ç‰‡åœ°å€çš„æ­¥éª¤å¦‚ä¸‹ï¼š</p>
<ol>
<li>ç™»å½•ä¸ƒç‰›ç½‘ç«™ï¼Œæ‰“å¼€å­˜å‚¨ç©ºé—´&gt;å†…å®¹ç®¡ç†</li>
<li>ä¸Šä¼ æ–‡ä»¶</li>
<li>è¿”å›å†…å®¹ç®¡ç†æ‰¾åˆ°åˆšæ‰ä¸Šä¼ çš„æ–‡ä»¶ï¼Œè·å–å¤–é“¾</li>
</ol>
<p>æŒ‰ç…§è¿™ä¸ªæ­¥éª¤ä¸Šä¼ ä¸€å¼ å›¾ç‰‡è‡³å°‘è€—æ—¶åŠåˆ†é’Ÿã€‚</p>
<p>é‚£èƒ½ä¸èƒ½ç®€åŒ–è¿™ä¸ªæ­¥éª¤å‘¢ï¼Ÿ</p>
<p>ç­”æ¡ˆæ˜¯<code>å¯ä»¥ï¼</code></p>
<p>å¾®ä¿¡å…¬å·æ˜¯å¯ä»¥å‘é€å›¾ç‰‡æ¶ˆæ¯çš„ï¼Œæˆ‘çš„åšæ³•æ˜¯</p>
<ol>
<li>å°†å›¾ç‰‡å‘é€åˆ°å…¬å·</li>
<li>æœåŠ¡å™¨è·å–è§¦å‘å›¾ç‰‡æ¶ˆæ¯çš„å¤„ç†é€»è¾‘&gt; å°†å›¾ç‰‡ä½¿ç”¨ä¸ƒç‰›æä¾›çš„<code>ç¬¬ä¸‰æ–¹èµ„æºæŠ“å–</code>API<code>å¦å­˜åˆ°</code>ï¼Œä¸ƒç‰›å­˜å‚¨ç©ºé—´</li>
<li>å°†è®¾å®šå¥½çš„å›¾ç‰‡åœ°å€è¿”å›ç»™å¾®ä¿¡ï¼Œå‘é€åˆ°å…¬å·æ¶ˆæ¯å¯¹è¯ä¸­</li>
</ol>
<p>ç¤ºä¾‹å¦‚ä¸‹å›¾æ‰€ç¤ºï¼š</p>
<figure data-type="image" tabindex="4"><img src="http://media.gusibi.mobi/Eg5Idjmp3nLyufBVU2hzp6jNMdNoSWEYgKTqNG9BbqD6VrM4U5oN-gmJw3PaN-Yh" alt="ä¸Šä¼ å›¾ç‰‡åˆ°ä¸ƒç‰›" loading="lazy"></figure>
<h3 id="å®ç°æ­¥éª¤">å®ç°æ­¥éª¤</h3>
<ul>
<li>æ³¨å†Œä¸ªä¸ƒç‰›è´¦å·</li>
<li>æ–°å»ºå­˜å‚¨ç©ºé—´</li>
<li>åœ¨ä¸ªäººä¸­å¿ƒç§˜é’¥ç®¡ç†è·å– AccessKey å’Œ SecreKey</li>
<li>pip install qiniu</li>
</ul>
<p>ä»£ç å®ç°å¦‚ä¸‹ï¼š</p>
<pre><code class="language-python"># media.py
# å›¾ç‰‡æŠ“å–é€»è¾‘å¤„ç†
from qiniu import Auth, BucketManager

from momo.settings import Config

def qiniu_auth():
    access_key = str(Config.QINIU_ACCESS_TOKEN)
    secret_key = str(Config.QINIU_SECRET_TOKEN)
    auth = Auth(access_key, secret_key)
    return auth
    
def media_fetch(media_url, media_id):
    '''æŠ“å–urlçš„èµ„æºå­˜å‚¨åœ¨åº“'''
    auth = qiniu_auth()
    bucket = BucketManager(auth)
    bucket_name = Config.QINIU_BUCKET  # å­˜å‚¨ç©ºé—´åç§°
    ret, info = bucket.fetch(media_url, bucket_name, media_id) # å‚æ•°ä¾æ¬¡æ˜¯ç¬¬ä¸‰æ–¹å›¾ç‰‡åœ°å€ï¼Œç©ºé—´åç§°ï¼Œç›®æ ‡æ–‡ä»¶å
    if info.status_code == 200:
        return True, media_id # å¦‚æœä¸Šä¼ æˆåŠŸï¼Œè¿”å›æ–‡ä»¶å
    return False, None
</code></pre>
<p>æŠ“å–ç¬¬ä¸‰æ–¹å›¾ç‰‡æ–‡æ¡£åœ°å€ä¸ºï¼š<a href="https://developer.qiniu.com/kodo/api/1263/fetch">ç¬¬ä¸‰æ–¹èµ„æºæŠ“å– https://developer.qiniu.com/kodo/api/1263/fetch</a>ã€‚</p>
<p>å¾®ä¿¡å›¾ç‰‡æ¶ˆæ¯å¤„ç†é€»è¾‘ä»£ç ï¼š</p>
<pre><code class="language-python">class WXResponse(_WXResponse):

    def _image_msg_handler(self):
        media_id = self.data['MediaId']
        picurl = None
        if not picurl:
            picurl = self.data['PicUrl']  # ä»æ¶ˆæ¯ä¸­è·å–å›¾ç‰‡åœ°å€
        is_succeed, media_key = media_fetch(picurl, media_id) # ä½¿ç”¨å›¾ç‰‡æŠ“å–æ¥å£å°†å›¾ç‰‡å­˜å‚¨åˆ°ä¸ƒç‰›å¹¶è·å–å›¾ç‰‡æ–‡ä»¶å
        if is_succeed:
            qiniu_url = '{host}/{key}'.format(host=Config.QINIU_HOST, key=media_key) # æ‹¼æ¥å›¾ç‰‡åœ°å€
        else:
            qiniu_url = 'å›¾ç‰‡ä¸Šä¼ å¤±è´¥ï¼Œè¯·é‡æ–°ä¸Šä¼ '
        self.reply_params['content'] = qiniu_url # è¿”å›å›¾ç‰‡åœ°å€
        self.reply = TextReply(**self.reply_params).render()
</code></pre>
<p>ä»£ç å·²å¼€æºé“githubï¼Œè¯¦ç»†ä»£ç é€»è¾‘å‚è€ƒ <a href="https://github.com/gusibi/momo/blob/chatterbot/momo/views/mweixin.py">gusibi/momo: https://github.com/gusibi/momo/tree/chatterbot</a></p>
<p>æ¬¢è¿è¯•ç”¨ä½“éªŒï¼š</p>
<ul>
<li>è¯·ä¸è¦ä¸Šä¼ é«˜æ¸…å›¾ç‰‡ï¼Œå¾®ä¿¡ä¼šå‹ç¼©æŸåå›¾ç‰‡è´¨é‡</li>
<li>ä¹Ÿä¸è¦ä¸Šä¼ å¤ªä¸ªäººçš„å›¾ç‰‡ï¼Œæ¯•ç«Ÿå†…å®¹æˆ‘èƒ½çœ‹åˆ°</li>
</ul>
<h2 id="æ€»ç»“">æ€»ç»“</h2>
<p>è¿™ä¸€ç¯‡ä¸»è¦æä¾›äº†ä¸¤ä¸ªè®­ç»ƒ chatterbot çš„æ€è·¯ï¼Œä»¥åŠä½¿ç”¨å…¬å·ä½œä¸ºå›¾ç‰‡ä¸Šä¼ å®¢æˆ·ç«¯æé«˜ä¸Šä¼ å›¾ç‰‡çš„æ•ˆç‡çš„è§£å†³æ–¹æ³•ã€‚<br>
æ¥ä¸‹æ¥å…¬å·è¿˜æ˜¯ç»§ç»­å¼€å‘ï¼Œå‡†å¤‡ç»™å…¬å·åŠ ä¸€ä¸ªè®°è´¦åŠŸèƒ½ï¼Œä¿ƒä½¿è‡ªå·±å…»æˆè®°è´¦çš„ä¹ æƒ¯ã€‚</p>
<h3 id="é¢„å‘Š">é¢„å‘Š</h3>
<p>ä¸‹ä¸€ç¯‡çš„å…¬å·DIY å°†ä»‹ç» <code>è®°è´¦çš„åŠŸèƒ½è®¾è®¡ä»¥åŠå®ç°æ€è·¯</code>ã€‚</p>
<hr>
<p><strong>æœ€åï¼Œæ„Ÿè°¢å¥³æœ‹å‹æ”¯æŒå’ŒåŒ…å®¹ï¼Œæ¯”â¤ï¸</strong></p>
<p>ä¹Ÿå¯ä»¥åœ¨å…¬å·è¾“å…¥ä»¥ä¸‹å…³é”®å­—è·å–å†å²æ–‡ç« ï¼š<code>å…¬å·&amp;å°ç¨‹åº</code> | <code>è®¾è®¡æ¨¡å¼</code> | <code>å¹¶å‘&amp;åç¨‹</code></p>
<figure data-type="image" tabindex="5"><img src="http://media.gusibi.mobi/zHqNew3j1brVxSoTkjOerslhnB_ZpchcOXf60lFUxiZ5YtnCHs5HrJNOP14go6Ea" alt="æ‰«ç å…³æ³¨" loading="lazy"></figure>
<hr>
<h3 id="å†…æ¨æ—¶é—´">å†…æ¨æ—¶é—´</h3>
<figure data-type="image" tabindex="6"><img src="http://media.gusibi.mobi/5FzreeM6IYt55JSQMAV63INPIvuPik75FlJAbP1e7Zdlg1WPe6BrHI-q0jkXskGf" alt="" loading="lazy"></figure>

              </div>
              <div class="toc-container">
                <ul class="markdownIt-TOC">
<li>
<ul>
<li><a href="#chatterbot-%E8%AE%AD%E7%BB%83%E9%80%BB%E8%BE%91%E5%A4%84%E7%90%86%E6%A8%A1%E5%9D%97">chatterbot è®­ç»ƒé€»è¾‘å¤„ç†æ¨¡å—</a>
<ul>
<li><a href="#%E5%A4%84%E7%90%86%E8%AE%AD%E7%BB%83%E6%95%B0%E6%8D%AE">å¤„ç†è®­ç»ƒæ•°æ®</a></li>
<li><a href="#%E4%BD%BF%E7%94%A8%E5%9B%BE%E7%81%B5%E6%9C%BA%E5%99%A8%E4%BA%BA%E8%AE%AD%E7%BB%83">ä½¿ç”¨å›¾çµæœºå™¨äººè®­ç»ƒ</a></li>
</ul>
</li>
<li><a href="#%E5%A6%82%E4%BD%95%E8%AE%A9%E5%BE%AE%E4%BF%A1%E5%85%AC%E5%8F%B7%E5%8C%96%E8%BA%AB%E5%9B%BE%E7%89%87%E4%B8%8A%E4%BC%A0%E5%8A%A9%E6%89%8B">å¦‚ä½•è®©å¾®ä¿¡å…¬å·åŒ–èº«å›¾ç‰‡ä¸Šä¼ åŠ©æ‰‹</a>
<ul>
<li><a href="#%E5%AE%9E%E7%8E%B0%E6%AD%A5%E9%AA%A4">å®ç°æ­¥éª¤</a></li>
</ul>
</li>
<li><a href="#%E6%80%BB%E7%BB%93">æ€»ç»“</a>
<ul>
<li><a href="#%E9%A2%84%E5%91%8A">é¢„å‘Š</a></li>
<li><a href="#%E5%86%85%E6%8E%A8%E6%97%B6%E9%97%B4">å†…æ¨æ—¶é—´</a></li>
</ul>
</li>
</ul>
</li>
</ul>

              </div>
            </div>
          </article>
        </div>

        
          <div class="next-post">
            <div class="next">ä¸‹ä¸€ç¯‡</div>
            <a href="http://blog.gusibi.site/post/weixin_chatbot_step_by_step/">
              <h3 class="post-title">
                å¾®ä¿¡å…¬å·DIYï¼šä¸€å°æ—¶æ­å»ºå¾®ä¿¡èŠå¤©æœºå™¨äºº
              </h3>
            </a>
          </div>
        

        
          

          
            <link rel="stylesheet" href="https://unpkg.com/disqusjs@1.1/dist/disqusjs.css">
<script src="https://unpkg.com/disqusjs@1.1/dist/disqus.js"></script>

<div id="disqus_thread"></div>

<script>

var options = {
  shortname: 'gu-si-bi',
  apikey: '',
}
if ('') {
  options.api = ''
}
var dsqjs = new DisqusJS(options)

</script>

          
        

        <div class="site-footer">
  Powered by <a href="https://github.com/getgridea/gridea" target="_blank">Gridea</a>
  <a class="rss" href="http://blog.gusibi.site/atom.xml" target="_blank">
    <i class="ri-rss-line"></i> RSS
  </a>
</div>

      </div>
    </div>

    <script>
      hljs.initHighlightingOnLoad()

      let mainNavLinks = document.querySelectorAll(".markdownIt-TOC a");

      // This should probably be throttled.
      // Especially because it triggers during smooth scrolling.
      // https://lodash.com/docs/4.17.10#throttle
      // You could do like...
      // window.addEventListener("scroll", () => {
      //    _.throttle(doThatStuff, 100);
      // });
      // Only not doing it here to keep this Pen dependency-free.

      window.addEventListener("scroll", event => {
        let fromTop = window.scrollY;

        mainNavLinks.forEach((link, index) => {
          let section = document.getElementById(decodeURI(link.hash).substring(1));
          let nextSection = null
          if (mainNavLinks[index + 1]) {
            nextSection = document.getElementById(decodeURI(mainNavLinks[index + 1].hash).substring(1));
          }
          if (section.offsetTop <= fromTop) {
            if (nextSection) {
              if (nextSection.offsetTop > fromTop) {
                link.classList.add("current");
              } else {
                link.classList.remove("current");    
              }
            } else {
              link.classList.add("current");
            }
          } else {
            link.classList.remove("current");
          }
        });
      });

    </script>
  </body>
</html>
